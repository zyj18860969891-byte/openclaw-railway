/**\n * éƒ¨ç½²éªŒè¯è„šæœ¬ - éªŒè¯å¤šé€šé“ç³»ç»Ÿå®Œæ•´æ€§\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { execSync } from 'child_process';\n\ninterface VerificationResult {\n  name: string;\n  status: 'PASS' | 'FAIL' | 'WARN';\n  message: string;\n  timestamp: string;\n}\n\nclass DeploymentVerifier {\n  private results: VerificationResult[] = [];\n\n  /**\n   * éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨\n   */\n  private checkFileExists(filePath: string, description: string): void {\n    const exists = fs.existsSync(filePath);\n    this.results.push({\n      name: `æ–‡ä»¶æ£€æŸ¥: ${description}`,\n      status: exists ? 'PASS' : 'FAIL',\n      message: exists\n        ? `âœ“ ${filePath} å­˜åœ¨`\n        : `âœ— ${filePath} ä¸å­˜åœ¨`,\n      timestamp: new Date().toISOString()\n    });\n  }\n\n  /**\n   * éªŒè¯ç¯å¢ƒå˜é‡\n   */\n  private checkEnvironmentVariables(): void {\n    const envVars = process.env;\n    const channelVars = Object.keys(envVars).filter(\n      (key) => key.includes('FEISHU') || key.includes('DINGTALK') || key.includes('WECHAT')\n    );\n\n    if (channelVars.length > 0) {\n      this.results.push({\n        name: 'ç¯å¢ƒå˜é‡æ£€æŸ¥',\n        status: 'PASS',\n        message: `âœ“ æ£€æµ‹åˆ° ${channelVars.length} ä¸ªé€šé“ç¯å¢ƒå˜é‡`,\n        timestamp: new Date().toISOString()\n      });\n    } else {\n      this.results.push({\n        name: 'ç¯å¢ƒå˜é‡æ£€æŸ¥',\n        status: 'WARN',\n        message: 'âš  æœªæ£€æµ‹åˆ°é€šé“ç¯å¢ƒå˜é‡ï¼Œå¯èƒ½ä¸ºæµ‹è¯•ç¯å¢ƒ',\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  /**\n   * éªŒè¯æ•°æ®åº“è¿æ¥\n   */\n  private async checkDatabaseConnection(): Promise<void> {\n    try {\n      const dbUrl = process.env.DATABASE_URL;\n      if (!dbUrl) {\n        this.results.push({\n          name: 'æ•°æ®åº“è¿æ¥æ£€æŸ¥',\n          status: 'FAIL',\n          message: 'âœ— DATABASE_URL ç¯å¢ƒå˜é‡æœªè®¾ç½®',\n          timestamp: new Date().toISOString()\n        });\n        return;\n      }\n\n      // è¿™é‡Œåº”è¯¥æ‰§è¡Œå®é™…çš„æ•°æ®åº“æŸ¥è¯¢æµ‹è¯•\n      this.results.push({\n        name: 'æ•°æ®åº“è¿æ¥æ£€æŸ¥',\n        status: 'PASS',\n        message: `âœ“ æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²å·²é…ç½®`,\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      this.results.push({\n        name: 'æ•°æ®åº“è¿æ¥æ£€æŸ¥',\n        status: 'FAIL',\n        message: `âœ— æ•°æ®åº“è¿æ¥å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  /**\n   * éªŒè¯TypeScriptç¼–è¯‘\n   */\n  private checkTypeScriptCompilation(): void {\n    try {\n      const srcDir = path.join(process.cwd(), 'src');\n      if (fs.existsSync(srcDir)) {\n        this.results.push({\n          name: 'TypeScriptæºä»£ç æ£€æŸ¥',\n          status: 'PASS',\n          message: `âœ“ src ç›®å½•å­˜åœ¨`,\n          timestamp: new Date().toISOString()\n        });\n      } else {\n        this.results.push({\n          name: 'TypeScriptæºä»£ç æ£€æŸ¥',\n          status: 'FAIL',\n          message: `âœ— src ç›®å½•ä¸å­˜åœ¨`,\n          timestamp: new Date().toISOString()\n        });\n      }\n    } catch (error) {\n      this.results.push({\n        name: 'TypeScriptæºä»£ç æ£€æŸ¥',\n        status: 'FAIL',\n        message: `âœ— æ£€æŸ¥å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  /**\n   * éªŒè¯ä¾èµ–åŒ…\n   */\n  private checkDependencies(): void {\n    try {\n      const packageJsonPath = path.join(process.cwd(), 'package.json');\n      if (!fs.existsSync(packageJsonPath)) {\n        this.results.push({\n          name: 'ä¾èµ–åŒ…æ£€æŸ¥',\n          status: 'FAIL',\n          message: 'âœ— package.json ä¸å­˜åœ¨',\n          timestamp: new Date().toISOString()\n        });\n        return;\n      }\n\n      const packageJson = JSON.parse(\n        fs.readFileSync(packageJsonPath, 'utf-8')\n      );\n\n      const requiredDeps = ['express', 'typescript', 'pg'];\n      const installedDeps = Object.keys(\n        { ...packageJson.dependencies, ...packageJson.devDependencies }\n      );\n\n      const missingDeps = requiredDeps.filter(\n        (dep) => !installedDeps.includes(dep)\n      );\n\n      if (missingDeps.length === 0) {\n        this.results.push({\n          name: 'ä¾èµ–åŒ…æ£€æŸ¥',\n          status: 'PASS',\n          message: `âœ“ æ‰€æœ‰å¿…éœ€çš„ä¾èµ–åŒ…å·²å®‰è£…`,\n          timestamp: new Date().toISOString()\n        });\n      } else {\n        this.results.push({\n          name: 'ä¾èµ–åŒ…æ£€æŸ¥',\n          status: 'FAIL',\n          message: `âœ— ç¼ºå°‘ä¾èµ–åŒ…: ${missingDeps.join(', ')}`,\n          timestamp: new Date().toISOString()\n        });\n      }\n    } catch (error) {\n      this.results.push({\n        name: 'ä¾èµ–åŒ…æ£€æŸ¥',\n        status: 'FAIL',\n        message: `âœ— æ£€æŸ¥å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`,\n        timestamp: new Date().toISOString()\n      });\n    }\n  }\n\n  /**\n   * éªŒè¯APIç«¯ç‚¹\n   */\n  private checkAPIEndpoints(): void {\n    const apiFiles = [\n      'src/api/channels.ts',\n      'src/config/channel-parser.ts',\n      'src/config/channel-manager.ts',\n      'src/services/allocation-engine.ts'\n    ];\n\n    let allFound = true;\n    for (const file of apiFiles) {\n      const filePath = path.join(process.cwd(), file);\n      if (!fs.existsSync(filePath)) {\n        allFound = false;\n        break;\n      }\n    }\n\n    this.results.push({\n      name: 'APIç«¯ç‚¹æ–‡ä»¶æ£€æŸ¥',\n      status: allFound ? 'PASS' : 'FAIL',\n      message: allFound\n        ? `âœ“ æ‰€æœ‰APIç«¯ç‚¹æ–‡ä»¶å·²å°±ä½`\n        : `âœ— éƒ¨åˆ†APIç«¯ç‚¹æ–‡ä»¶ç¼ºå¤±`,\n      timestamp: new Date().toISOString()\n    });\n  }\n\n  /**\n   * æ‰§è¡Œæ‰€æœ‰éªŒè¯\n   */\n  async runAllVerifications(): Promise<void> {\n    console.log('\\nğŸ” å¼€å§‹éƒ¨ç½²éªŒè¯...\\n');\n\n    // åŸºç¡€æ–‡ä»¶æ£€æŸ¥\n    this.checkFileExists(\n      path.join(process.cwd(), 'package.json'),\n      'package.json'\n    );\n    this.checkFileExists(\n      path.join(process.cwd(), 'tsconfig.json'),\n      'tsconfig.json'\n    );\n\n    // ç¯å¢ƒå˜é‡\n    this.checkEnvironmentVariables();\n\n    // ä¾èµ–åŒ…\n    this.checkDependencies();\n\n    // æ•°æ®åº“\n    await this.checkDatabaseConnection();\n\n    // TypeScript\n    this.checkTypeScriptCompilation();\n\n    // APIç«¯ç‚¹\n    this.checkAPIEndpoints();\n  }\n\n  /**\n   * ç”ŸæˆéªŒè¯æŠ¥å‘Š\n   */\n  generateReport(): string {\n    const passCount = this.results.filter((r) => r.status === 'PASS').length;\n    const failCount = this.results.filter((r) => r.status === 'FAIL').length;\n    const warnCount = this.results.filter((r) => r.status === 'WARN').length;\n    const totalCount = this.results.length;\n\n    let report = '\\n\\nğŸ“‹ éªŒè¯æŠ¥å‘Š\\n';\n    report += 'â•'.repeat(50) + '\\n\\n';\n\n    for (const result of this.results) {\n      const icon =\n        result.status === 'PASS' ? 'âœ…' : result.status === 'FAIL' ? 'âŒ' : 'âš ï¸';\n      report += `${icon} [${result.status}] ${result.name}\\n`;\n      report += `   ${result.message}\\n\\n`;\n    }\n\n    report += 'â•'.repeat(50) + '\\n';\n    report += `\\nç»Ÿè®¡:\\n`;\n    report += `  âœ… é€šè¿‡: ${passCount}\\n`;\n    report += `  âŒ å¤±è´¥: ${failCount}\\n`;\n    report += `  âš ï¸  è­¦å‘Š: ${warnCount}\\n`;\n    report += `  æ€»è®¡: ${totalCount}\\n\\n`;\n\n    if (failCount === 0) {\n      report += 'ğŸ‰ æ‰€æœ‰éªŒè¯é€šè¿‡ï¼ç³»ç»Ÿå·²å‡†å¤‡å¥½éƒ¨ç½²ã€‚\\n';\n    } else {\n      report += `âš ï¸  å‘ç° ${failCount} é¡¹éªŒè¯å¤±è´¥ï¼Œè¯·ä¿®å¤åå†éƒ¨ç½²ã€‚\\n`;\n    }\n\n    return report;\n  }\n\n  /**\n   * ä¿å­˜æŠ¥å‘Šåˆ°æ–‡ä»¶\n   */\n  saveReport(filePath: string): void {\n    const report = this.generateReport();\n    fs.writeFileSync(filePath, report);\n    console.log(`\\nğŸ“ æŠ¥å‘Šå·²ä¿å­˜åˆ°: ${filePath}`);\n  }\n}\n\n// ä¸»å‡½æ•°\nasync function main() {\n  const verifier = new DeploymentVerifier();\n  await verifier.runAllVerifications();\n  console.log(verifier.generateReport());\n  verifier.saveReport('deployment-verification-report.txt');\n}\n\n// å¯¼å‡ºç±»ä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨\nexport { DeploymentVerifier };\n\n// å¦‚æœç›´æ¥è¿è¡Œæ­¤è„šæœ¬\nif (require.main === module) {\n  main().catch((error) => {\n    console.error('éªŒè¯è¿‡ç¨‹å‡ºé”™:', error);\n    process.exit(1);\n  });\n}\n"