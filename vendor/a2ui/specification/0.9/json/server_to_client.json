{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://a2ui.dev/specification/0.9/server_to_client.json",
  "title": "A2UI Message Schema",
  "description": "Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces.",
  "type": "object",
  "oneOf": [
    { "$ref": "#/$defs/CreateSurfaceMessage" },
    { "$ref": "#/$defs/UpdateComponentsMessage" },
    { "$ref": "#/$defs/UpdateDataModelMessage" },
    { "$ref": "#/$defs/DeleteSurfaceMessage" }
  ],
  "$defs": {
    "CreateSurfaceMessage": {
      "properties": {
        "createSurface": {
          "type": "object",
          "description": "Signals the client to create a new surface and begin rendering it. When this message is sent, the client will expect 'updateComponents' and/or 'updateDataModel' messages for the same surfaceId that define the component tree.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be rendered."
            },
            "catalogId": {
              "title": "Catalog ID",
              "description": "A string that uniquely identifies this catalog. It is recommended to prefix this with an internet domain that you own, to avoid conflicts e.g. mycompany.com:somecatalog'.",
              "type": "string"
            }
          },
          "required": ["surfaceId", "catalogId"],
          "additionalProperties": false
        }
      },
      "required": ["createSurface"],
      "additionalProperties": false
    },
    "UpdateComponentsMessage": {
      "properties": {
        "updateComponents": {
          "type": "object",
          "description": "Updates a surface with a new set of components. This message can be sent multiple times to update the component tree of an existing surface. One of the components in one of the components lists MUST have an 'id' of 'root' to serve as the root of the component tree. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be updated."
            },

            "components": {
              "type": "array",
              "description": "A list containing all UI components for the surface.",
              "minItems": 1,
              "items": {
                "$ref": "standard_catalog_definition.json#/$defs/anyComponent"
              }
            }
          },
          "required": ["surfaceId", "components"],
          "additionalProperties": false
        }
      },
      "required": ["updateComponents"],
      "additionalProperties": false
    },
    "UpdateDataModelMessage": {
      "properties": {
        "updateDataModel": {
          "type": "object",
          "description": "Updates the data model for an existing surface. This message can be sent multiple times to update the data model. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface this data model update applies to."
            },
            "path": {
              "type": "string",
              "description": "An optional path to a location within the data model (e.g., '/user/name'). If omitted, or set to '/', refers to the entire data model."
            },
            "op": {
              "type": "string",
              "description": "The operation to perform on the data model. Defaults to 'replace' if omitted.",
              "enum": ["add", "replace", "remove"]
            },
            "value": {
              "description": "The data to be updated in the data model. Required for 'add' and 'replace' operations. Not allowed for 'remove' operation.",
              "additionalProperties": true
            }
          },
          "required": ["surfaceId"],
          "additionalProperties": false
        }
      },
      "required": ["updateDataModel"],
      "additionalProperties": false
    },
    "DeleteSurfaceMessage": {
      "properties": {
        "deleteSurface": {
          "type": "object",
          "description": "Signals the client to delete the surface identified by 'surfaceId'. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be deleted."
            }
          },
          "required": ["surfaceId"],
          "additionalProperties": false
        }
      },
      "required": ["deleteSurface"],
      "additionalProperties": false
    }
  }
}
